原文：[Finding Similar Music using Matrix Factorization](http://www.benfrederickson.com/matrix-factorization/)

---

之前，我写了一篇关于[如何构建一个'喜欢这个的人也喜欢……'特性](/distance-metrics/)文章，用来展示相似音乐家名单。我的目标是为了显示用信息检索技术来很好的计算相关艺术家列表是多么的简单。例如，在The Beatles上使用BM25距离表明，最相似的艺术家是John Lennon和Paul McCartney。

我没有涉及的一个有趣的技术是，在计算相关艺术家之前，使用矩阵分解的方法来减少数据的维度。这种分析可以生成使用我原来的博文中的技术没法找到的匹配。

本文一步步指导如何使用几个不同的矩阵分解算法来计算相关的艺术家。代码使用Python编写的，使用[Pandas](http://pandas.pydata.org/)和[SciPy](https://www.scipy.org/)来进行计算，使用[D3.js](https://d3js.org/)来交互式可视化结果。

作为这篇文章的一不分，我还开源了一个[隐式交替最小二乘的高性能Python版本](http://github.com/benfred/implicit)矩阵分解算法。这里大部分的代码可以在该项目的样例目录下找到。


### 加载数据

在本文中，我使用与我第一篇文章相同的[Last.fm数据集](http://www.dtic.upf.edu/~ocelma/MusicRecommendationDataset/lastfm-360K.html)。使用Pandas，你只需要几行代码，就可以把它加载到一个稀疏矩阵中：

```python
# read in triples of user/artist/playcount from the input dataset
data = pandas.read_table("usersha1-artmbid-artname-plays.tsv", 
                         usecols=[0, 2, 3], 
                         names=['user', 'artist', 'plays'])

# map each artist and user to a unique numeric value
data['user'] = data['user'].astype("category")
data['artist'] = data['artist'].astype("category")

# create a sparse matrix of all the artist/user/play triples
plays = coo_matrix((data['plays'].astype(float), 
                   (data['artist'].cat.codes, 
                    data['user'].cat.codes)))

```

这里返回的矩阵具有300,000个艺术家和360,000个用户，以及约一千七百万项。每项表示用户播放该艺术家音乐的次数，以及在2008年，使用Last.fm API收集到的数据。

### 矩阵分解

通常用于此问题的一个技术是将用户-艺术家-播放矩阵投射到一个低秩逼近，然后计算该空间的距离。

想法是获得原始的播放次数矩阵，然后将其减小到两个更小的矩阵，这两个更小的矩阵相乘得到的结果近似于原始矩阵：

<div id="mf"><svg width="750" height="312.5"><rect x="25" y="25" width="262.5" height="262.5" fill="#1f77b4" fill-opacity=".25" stroke="#1f77b4" stroke-opacity=".8"></rect><text text-anchor="middle" dy=".3em" x="156.25" y="156.25" style="font-size: 12px;">Artist/User/Play Counts</text><rect x="362.5" y="25" width="25" height="262.5" fill="#ff7f0e" fill-opacity=".25" stroke="#ff7f0e" stroke-opacity=".8"></rect><text text-anchor="middle" dy=".3em" x="375" transform="rotate(90, 375,156.25)" y="156.25" style="font-size: 12px;">Artist Factors</text><rect x="462.5" y="143.75" width="262.5" height="25" fill="#ff7f0e" fill-opacity=".25" stroke="#ff7f0e" stroke-opacity=".8"></rect><text text-anchor="middle" dy=".3em" x="593.75" y="156.25" style="font-size: 12px;">User Factors</text><text text-anchor="middle" dy=".3em" x="325" y="156.25" style="font-size: 24px;">=</text><text text-anchor="middle" dy=".3em" x="425" y="156.25" style="font-size: 24px;">×</text></svg></div>


与将每个艺术家表示为所有的360,000个可能的用户的播放次数的一个稀疏向量相反，在分解矩阵后，每个艺术家将会由一个50维的密集矢量所表示。

通过减少像这样的数据维度，我们实际上是将输入矩阵压缩到两个小得多的矩阵。这种压缩迫使输入数据的泛化，而这种泛化会使得更好的理解数据。

### 潜在语义分析

因式分解输入矩阵的一个简单方法是计算在一个适当的加权矩阵上的[奇异值分解](https://en.wikipedia.org/wiki/Singular_value_decomposition)[(1)](#footnote1)：

```python
artist_factors, _, user_factors = scipy.sparse.linalg.svds(bm25_weight(plays), 50)
```

SVD（奇异值分解）是那些令人惊讶的有用技术之一，可以被用于像[主成分分析](https://en.wikipedia.org/wiki/Principal_component_analysis)或者[多维标度](http://localhost:4000/multidimensional-scaling/)。我刚想包含一个关于它如何工作的概述，但最近Jeremy Kun写了一篇[SVD的优秀概述](https://jeremykun.com/2016/04/18/singular-value-decomposition-part-1-perspectives-on-linear-algebra/)，而我不会尝试超越他。对于这篇文章的目的，我们只需要知道，SVD生成输入矩阵的一个低秩逼近，而我们可以使用那个低秩逼近表示。

这样使用SVD被称为[潜在语义分析](https://en.wikipedia.org/wiki/Latent_semantic_analysis) (LSA)。其真正包含的是，通过该分解空间中的余弦距离来获得最相关的艺术家，这可以这样做：

```python
class TopRelated(object):
    def __init__(self, artist_factors):
        # fully normalize artist_factors, so can compare with only the dot product
        norms = numpy.linalg.norm(artist_factors, axis=-1)
        self.factors = artist_factors / norms[:, numpy.newaxis]

    def get_related(self, artistid, N=10):
        scores = self.factors.dot(self.factors[artistid])
        best = numpy.argpartition(scores, -N)[-N:]
        return sorted((best, scores[best]), key=lambda x: -x[1])
```

在分解矩阵后，输入数据中的潜在隐藏结构会暴露出来，潜在语义分析因此得名 —— 这可以被认为是揭示输入数据的语义。

例如，'Arcade Fire'和'The Arcade Fire'在我所使用的数据集中并无相同的听众：它由Last.fm的历史所生成，而人们要么使用他们音乐库中的一个标签，要么使用另一个。

这意味着，所有的比较艺术家的直接方法都认为，这两个乐队是完全不一样的。然而，这些标签都指向一个相同的乐队 —— LSA试图获取的事实是，他们的排名彼此最为相似：

<div class="cosinelist well" style="background:#FFFFFF;">
<div class="row">
  <div class="col-lg-6">
    <div class="input-group">
      <div class="input-group-btn">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
          <span class="cosine-method"><font><font>LSA</font></font></span> <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu" style="width: 200px;">
          <li><a class="lsi"><font><font>LSA</font></font></a></li>
          <li><a class="implicitals"><font><font>隐ALS</font></font></a></li>
        </ul>
      </div>
    <span class="twitter-typeahead" style="position: relative"><input class="form-control typeahead tt-hint" style="position: absolute; top: 0px; left: 0px; border-color: transparent; box-shadow: none; opacity: 1; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(255, 255, 255);" readonly="" autocomplete="off" spellcheck="false" tabindex="-1"><input class="form-control typeahead tt-input" id="set-artist-name" style="position: relative; vertical-align: top; background-color: transparent;" placeholder="Enter an Artist Name" autocomplete="off" spellcheck="false" dir="auto"><pre aria-hidden="true" style="position: absolute; visibility: hidden; white-space: pre; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: 400; word-spacing: 0px; letter-spacing: 0px; text-indent: 0px; text-rendering: auto; text-transform: none;"></pre><span class="tt-dropdown-menu" style="position: absolute; top: 100%; z-index: 100; display: none; left: 0px; right: auto;"><div class="tt-dataset-artists"></div></span></span>
    </div>
  </div>
</div>
<div>
<hr>
<div class="resultstitle"><h4><font><font>类似的“拱廊之火”由LSA：</font></font></h4></div>

<div class="row">
<div class="artistlist col-sm-6"><table class="table table-striped table-hover" style="table-layout:fixed"><thead><tr><th><font><font>艺术家</font></font></th><th><font><font>LSA</font></font></th></tr></thead><tbody><tr><td><a style="color:black"><font><font>在拱廊之火</font></font></a></td><td><font><font>0.988</font></font></td></tr><tr><td><a style="color:black"><font><font>该逗人</font></font></a></td><td><font><font>0.985</font></font></td></tr><tr><td><a style="color:black"><font><font>救护车有限公司</font></font></a></td><td><font><font>0.984</font></font></td></tr><tr><td><a style="color:black"><font><font>全国</font></font></a></td><td><font><font>0.981</font></font></td></tr><tr><td><a style="color:black"><font><font>拍拍手说好啊</font></font></a></td><td><font><font>0.977</font></font></td></tr></tbody><tfoot><tr><td><a><font><font>更多 ...</font></font></a></td><td></td></tr></tfoot></table></div>
<div class="venn col-sm-6" style="padding:0px"><svg width="370" height="277.5"><g class="venn-area venn-circle venn-sets-The Arcade Fire"><path style="fill-opacity: 0.25; fill: rgb(255, 127, 14); stroke-opacity: 0; stroke: rgb(255, 255, 255); stroke-width: 0;" d="
M 68.2464454432251 205.9255223121374 
m -53.24644544322509 0 
a 53.24644544322509 53.24644544322509 0 1 0 106.49289088645018 0 
a 53.24644544322509 53.24644544322509 0 1 0 -106.49289088645018 0"></path><text text-anchor="middle" dy=".35em" x="66" y="209" style="fill: rgb(255, 127, 14); font-size: 12px;"><tspan x="66" y="209" dy="-0.7500000000000001em">The</tspan><tspan x="66" y="209" dy="0.35em">Arcade</tspan><tspan x="66" y="209" dy="1.4500000000000002em">Fire</tspan></text></g><g class="venn-area venn-circle venn-sets-The Dears"><path style="fill-opacity: 0.25; fill: rgb(44, 160, 44); stroke-opacity: 0; stroke: rgb(255, 255, 255); stroke-width: 0;" d="
M 99.84613957559345 138.75 
m -28.640549150787812 0 
a 28.640549150787812 28.640549150787812 0 1 0 57.281098301575625 0 
a 28.640549150787812 28.640549150787812 0 1 0 -57.281098301575625 0"></path><text text-anchor="middle" dy=".35em" x="89" y="137" style="fill: rgb(44, 160, 44); font-size: 12px;"><tspan x="89" y="137" dy="-0.20000000000000007em">The</tspan><tspan x="89" y="137" dy="0.9em">Dears</tspan></text></g><g class="venn-area venn-circle venn-sets-Arcade Fire"><path style="fill-opacity: 0.25; fill: rgb(31, 119, 180); stroke-opacity: 0; stroke: rgb(255, 255, 255); stroke-width: 0;" d="
M 231.61034132865382 138.75 
m -123.38965867134617 0 
a 123.38965867134617 123.38965867134617 0 1 0 246.77931734269234 0 
a 123.38965867134617 123.38965867134617 0 1 0 -246.77931734269234 0"></path><text text-anchor="middle" dy=".35em" x="241" y="138" style="fill: rgb(31, 119, 180); font-size: 12px;"><tspan x="241" y="138" dy="0.35em">Arcade Fire</tspan></text></g><g class="venn-area venn-intersection venn-sets-Arcade Fire_The Dears"><path style="fill-opacity: 0; stroke-opacity: 0; stroke: rgb(255, 255, 255); stroke-width: 0;" d="
M 111.067237616283 165.10086363707885 
A 123.38965867134617 123.38965867134617 0 0 1 111.067237616283 112.39913636292115 
A 28.640549150787812 28.640549150787812 0 0 1 111.067237616283 165.10086363707885"></path><text text-anchor="middle" dy=".35em" x="118" y="138" style="fill: rgb(68, 68, 68); font-size: 12px;"><tspan x="118" y="138" dy="0.35em"></tspan></text></g><g class="venn-area venn-intersection venn-sets-The Arcade Fire_The Dears"><path style="fill-opacity: 0; stroke-opacity: 0; stroke: rgb(255, 255, 255); stroke-width: 0;" d="
M 75.0704046966308 153.11815982880364 
A 53.24644544322509 53.24644544322509 0 0 1 104.5753028970562 166.99740819858744 
A 28.640549150787812 28.640549150787812 0 0 1 75.0704046966308 153.11815982880364"></path><text text-anchor="middle" dy=".35em" x="89" y="161" style="fill: rgb(68, 68, 68); font-size: 12px;"><tspan x="89" y="161" dy="0.35em"></tspan></text></g><g class="venn-area venn-intersection venn-sets-Arcade Fire_The Arcade Fire"><path style="fill-opacity: 0; stroke-opacity: 0; stroke: rgb(255, 255, 255); stroke-width: 0;" d="M 0 0"></path><text text-anchor="middle" dy=".35em" x="0" y="-1000" style="fill: rgb(68, 68, 68); font-size: 12px;"><tspan x="0" y="-1000" dy="0.35em"></tspan></text></g><g class="venn-area venn-intersection venn-sets-Arcade Fire_The Arcade Fire_The Dears"><path style="fill-opacity: 0; stroke-opacity: 0; stroke: rgb(255, 255, 255); stroke-width: 0;" d="M 0 0"></path><text text-anchor="middle" dy=".35em" x="0" y="-1000" style="fill: rgb(68, 68, 68); font-size: 12px;"><tspan x="0" y="-1000" dy="0.35em"></tspan></text></g></svg></div>
</div>
</div>
</div>

你还可以看到，"Guns N Roses"与"Guns N' Roses"和"Nick Cave and
the Bad Seeds"与"Nick Cave the Bad Seeds"也具有相同的效果。随意输入其他艺术家，但请记住，这个数据集是2008年的，所以，这里并没有更晚点的艺术家。（Ele注：这里无法重现效果，请到原文进行尝试）

虽然LSA成功的一般化了我们的数据的某些方面，但是这里的结果并不完美。例如，看看Bob Dylan的结果。

要做得更好，并仍保持一般化的能力，我们需要想出一个更好的模型。

### 隐式交替最小二乘

推荐系统经常使用矩阵分解模型来[为用户生成个性化推荐](https://datajobs.com/data-science-repo/Recommender-Systems-[Netflix].pdf)。已发现这些模型在推荐东西上工作良好，并且可以容易的重复用于计算相关艺术家。

在推荐系统中使用的许多MF模型都假定明确的数据，其中，用户使用一些，例如五星评定，来对他们喜欢或不喜欢的东西进行评定。他们通常将确实的数据看成未知，然后使用SGD最小化重构错误。
 
虽然，这里的数据是隐式的 —— 我们可以假设，一个用户听一个艺术家的歌表示他喜欢这首歌，但我们并没有相应的信号可以表明一个用户不喜欢一个艺术家。与显式数据相比，隐式数据通常更加丰满和易于收集 —— 但即使一个用户给了5星评定，但[绝大部分的评级将只是积极的](/rating-set-distributions)，所以无论如何，你都需要考虑隐性行为。

这意味着，我们不能只是将缺失的数据当成未知，取而代之，我们必须将一个不听某个艺术家的音乐的用户当成该用户可能不喜欢那个艺术家的信号。

这表示了在学习因式分解时的几个挑战。

第一个挑战是有效地进行这种分解：通过将未知当成负数，原生实现将会遍历输入矩阵中的每一项。由于这里的维度大约是360K x 300K —— 相对于只有1千七百万个非零项，总共有超过一千亿的项要考虑。

第二个问题是，我们不能肯定，一个用户不听某个艺术家的歌就真的表示他不喜欢它。可能还有其他原因使得他不听这个艺术家的歌，特别是考虑到，在数据集中，对于每一个用户，我们只有前50个播放次数最多的艺术家。

[用于隐式反馈数据集的协同过滤](http://yifanhu.net/PUB/cf.pdf)论文以一种优雅的方式，考虑到了这两种挑战。

要处理我们对我们的负数数据不自信的情况，这个方法使用二分偏好上的不同置信水平来学习一个因式分解的矩阵表示：看不见的项被当做具有一个低的置信值的负数，而看得见的项则被当做具有较高的置信值的正数。

那么，我们的目标是通过最小化平方误差函数的置信加权和，来学习用户因子X<sub>u</sub>和艺术家因子Y<sub>i</sub>：

<blockquote style="font-size:14px">
<span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>=</mo><munder><mo>&amp;#x2211;</mo><mi>u</mi></munder><munder><mo>&amp;#x2211;</mo><mi>i</mi></munder><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>C</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>u</mi><mi>i</mi></mrow></msub><mo stretchy=&quot;false&quot;>(</mo><msub><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>u</mi><mi>i</mi></mrow></msub><mo>&amp;#x2212;</mo><msub><mi>X</mi><mi>u</mi></msub><msub><mi>Y</mi><mi>i</mi></msub><msup><mo stretchy=&quot;false&quot;>)</mo><mn>2</mn></msup></mrow><mo>+</mo><mi>&amp;#x03BB;</mi><mo stretchy=&quot;false&quot;>(</mo><mo>&amp;#x2225;</mo><msub><mi>X</mi><mi>u</mi></msub><msup><mo>&amp;#x2225;</mo><mn>2</mn></msup><mo>+</mo><mo>&amp;#x2225;</mo><msub><mi>Y</mi><mi>i</mi></msub><msup><mo>&amp;#x2225;</mo><mn>2</mn></msup><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" role="math" style="width: 27.384em; display: inline-block;"><span style="display: inline-block; position: relative; width: 22.801em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.074em 1022.68em 3.574em -999.997em); top: -2.199em; left: 0.003em;"><span class="mrow" id="MathJax-Span-2"><span class="mi" id="MathJax-Span-3" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-4" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-5" style="font-family: MathJax_Math-italic;">s</span><span class="mi" id="MathJax-Span-6" style="font-family: MathJax_Math-italic;">s</span><span class="mo" id="MathJax-Span-7" style="font-family: MathJax_Main; padding-left: 0.301em;">=</span><span class="munderover" id="MathJax-Span-8" style="padding-left: 0.301em;"><span style="display: inline-block; position: relative; width: 1.432em; height: 0px;"><span style="position: absolute; clip: rect(2.86em 1001.37em 4.646em -999.997em); top: -3.985em; left: 0.003em;"><span class="mo" id="MathJax-Span-9" style="font-family: MathJax_Size2; vertical-align: 0.003em;">∑</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.515em 1000.42em 4.289em -999.997em); top: -2.914em; left: 0.539em;"><span class="mi" id="MathJax-Span-10" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="munderover" id="MathJax-Span-11" style="padding-left: 0.182em;"><span style="display: inline-block; position: relative; width: 1.432em; height: 0px;"><span style="position: absolute; clip: rect(2.86em 1001.37em 4.646em -999.997em); top: -3.985em; left: 0.003em;"><span class="mo" id="MathJax-Span-12" style="font-family: MathJax_Size2; vertical-align: 0.003em;">∑</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; clip: rect(3.336em 1000.24em 4.289em -999.997em); top: -2.914em; left: 0.598em;"><span class="mi" id="MathJax-Span-13" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="texatom" id="MathJax-Span-14" style="padding-left: 0.182em;"><span class="mrow" id="MathJax-Span-15"><span class="msubsup" id="MathJax-Span-16"><span style="display: inline-block; position: relative; width: 1.432em; height: 0px;"><span style="position: absolute; clip: rect(3.098em 1000.78em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-17" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.717em;"><span class="texatom" id="MathJax-Span-18"><span class="mrow" id="MathJax-Span-19"><span class="mi" id="MathJax-Span-20" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-21" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="mo" id="MathJax-Span-22" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-23"><span style="display: inline-block; position: relative; width: 1.372em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.78em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-24" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.122em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.658em;"><span class="texatom" id="MathJax-Span-25"><span class="mrow" id="MathJax-Span-26"><span class="mi" id="MathJax-Span-27" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-28" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="mo" id="MathJax-Span-29" style="font-family: MathJax_Main; padding-left: 0.241em;">−</span><span class="msubsup" id="MathJax-Span-30" style="padding-left: 0.241em;"><span style="display: inline-block; position: relative; width: 1.313em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.84em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-31" style="font-family: MathJax_Math-italic;">X<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.836em;"><span class="mi" id="MathJax-Span-32" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-33"><span style="display: inline-block; position: relative; width: 0.896em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.78em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-34" style="font-family: MathJax_Math-italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.182em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.598em;"><span class="mi" id="MathJax-Span-35" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-36"><span style="display: inline-block; position: relative; width: 0.836em; height: 0px;"><span style="position: absolute; clip: rect(3.039em 1000.3em 4.408em -999.997em); top: -3.985em; left: 0.003em;"><span class="mo" id="MathJax-Span-37" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -4.402em; left: 0.42em;"><span class="mn" id="MathJax-Span-38" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-39" style="font-family: MathJax_Main; padding-left: 0.241em;">+</span><span class="mi" id="MathJax-Span-40" style="font-family: MathJax_Math-italic; padding-left: 0.241em;">λ</span><span class="mo" id="MathJax-Span-41" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-42" style="font-family: MathJax_Main;">∥</span><span class="msubsup" id="MathJax-Span-43"><span style="display: inline-block; position: relative; width: 1.313em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.84em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-44" style="font-family: MathJax_Math-italic;">X<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.836em;"><span class="mi" id="MathJax-Span-45" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-46"><span style="display: inline-block; position: relative; width: 0.955em; height: 0px;"><span style="position: absolute; clip: rect(3.039em 1000.36em 4.408em -999.997em); top: -3.985em; left: 0.003em;"><span class="mo" id="MathJax-Span-47" style="font-family: MathJax_Main;">∥</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -4.402em; left: 0.479em;"><span class="mn" id="MathJax-Span-48" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="mo" id="MathJax-Span-49" style="font-family: MathJax_Main; padding-left: 0.241em;">+</span><span class="mo" id="MathJax-Span-50" style="font-family: MathJax_Main; padding-left: 0.241em;">∥</span><span class="msubsup" id="MathJax-Span-51"><span style="display: inline-block; position: relative; width: 0.896em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.78em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-52" style="font-family: MathJax_Math-italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.182em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.598em;"><span class="mi" id="MathJax-Span-53" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-54"><span style="display: inline-block; position: relative; width: 0.955em; height: 0px;"><span style="position: absolute; clip: rect(3.039em 1000.36em 4.408em -999.997em); top: -3.985em; left: 0.003em;"><span class="mo" id="MathJax-Span-55" style="font-family: MathJax_Main;">∥</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -4.402em; left: 0.479em;"><span class="mn" id="MathJax-Span-56" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="mo" id="MathJax-Span-57" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.496em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 2.718em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"></span></span></div>
</blockquote>


<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>C</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>u</mi><mi>i</mi></mrow></msub></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-58" role="math" style="width: 1.789em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.491em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.313em 1001.49em 2.562em -999.997em); top: -2.199em; left: 0.003em;"><span class="mrow" id="MathJax-Span-59"><span class="msubsup" id="MathJax-Span-60"><span style="display: inline-block; position: relative; width: 1.432em; height: 0px;"><span style="position: absolute; clip: rect(3.098em 1000.78em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-61" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.717em;"><span class="texatom" id="MathJax-Span-62"><span class="mrow" id="MathJax-Span-63"><span class="mi" id="MathJax-Span-64" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-65" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.146em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"></span></span><script type="math/tex" id="MathJax-Element-2">C_{ui}</script> 是我们所具有的用户喜欢该艺术家的置信度，<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>u</mi><mi>i</mi></mrow></msub></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-66" role="math" style="width: 1.729em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.432em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.372em 1001.43em 2.562em -999.997em); top: -2.199em; left: 0.003em;"><span class="mrow" id="MathJax-Span-67"><span class="msubsup" id="MathJax-Span-68"><span style="display: inline-block; position: relative; width: 1.372em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.78em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-69" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.122em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.658em;"><span class="texatom" id="MathJax-Span-70"><span class="mrow" id="MathJax-Span-71"><span class="mi" id="MathJax-Span-72" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-73" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.146em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation">是一个二进制值，它表示该用户是否听这个艺术家的歌，而<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03BB;</mi></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-74" role="math" style="width: 0.717em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.313em 1000.6em 2.384em -999.997em); top: -2.199em; left: 0.003em;"><span class="mrow" id="MathJax-Span-75"><span class="mi" id="MathJax-Span-76" style="font-family: MathJax_Math-italic;">λ</span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.004em;"></span></span></nobr>是一个基本的[L2正则化矩阵](https://en.wikipedia.org/wiki/Regularization_(mathematics))，用来减少过度拟合。

要最小化用户因子，我们固定项的因子常量不变，然后使用损失函数的导数来直接计算X<sub>u</sub>：

<blockquote style="font-size:14px">

<span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>X</mi><mi>u</mi></msub><mo>=</mo><mo stretchy=&quot;false&quot;>(</mo><msup><mi>Y</mi><mi>T</mi></msup><msub><mi>C</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>u</mi></mrow></msub><mi>Y</mi><mo>+</mo><mi>&amp;#x03BB;</mi><mi>I</mi><msup><mo stretchy=&quot;false&quot;>)</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msup><mo stretchy=&quot;false&quot;>(</mo><msup><mi>Y</mi><mi>T</mi></msup><msub><mi>C</mi><mi>U</mi></msub><msub><mi>P</mi><mi>u</mi></msub><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-77" role="math" style="width: 17.86em; display: inline-block;"><span style="display: inline-block; position: relative; width: 14.884em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.134em 1014.77em 2.622em -999.997em); top: -2.199em; left: 0.003em;"><span class="mrow" id="MathJax-Span-78"><span class="msubsup" id="MathJax-Span-79"><span style="display: inline-block; position: relative; width: 1.313em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.84em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-80" style="font-family: MathJax_Math-italic;">X<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.836em;"><span class="mi" id="MathJax-Span-81" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="mo" id="MathJax-Span-82" style="font-family: MathJax_Main; padding-left: 0.301em;">=</span><span class="mo" id="MathJax-Span-83" style="font-family: MathJax_Main; padding-left: 0.301em;">(</span><span class="msubsup" id="MathJax-Span-84"><span style="display: inline-block; position: relative; width: 1.432em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.78em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-85" style="font-family: MathJax_Math-italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.182em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -4.402em; left: 0.896em;"><span class="mi" id="MathJax-Span-86" style="font-size: 70.7%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-87"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.098em 1000.78em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-88" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.717em;"><span class="texatom" id="MathJax-Span-89"><span class="mrow" id="MathJax-Span-90"><span class="mi" id="MathJax-Span-91" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="mi" id="MathJax-Span-92" style="font-family: MathJax_Math-italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.182em;"></span></span><span class="mo" id="MathJax-Span-93" style="font-family: MathJax_Main; padding-left: 0.241em;">+</span><span class="mi" id="MathJax-Span-94" style="font-family: MathJax_Math-italic; padding-left: 0.241em;">λ</span><span class="mi" id="MathJax-Span-95" style="font-family: MathJax_Math-italic;">I<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span class="msubsup" id="MathJax-Span-96"><span style="display: inline-block; position: relative; width: 1.372em; height: 0px;"><span style="position: absolute; clip: rect(3.039em 1000.3em 4.408em -999.997em); top: -3.985em; left: 0.003em;"><span class="mo" id="MathJax-Span-97" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -4.402em; left: 0.42em;"><span class="texatom" id="MathJax-Span-98"><span class="mrow" id="MathJax-Span-99"><span class="mo" id="MathJax-Span-100" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-101" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="mo" id="MathJax-Span-102" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-103"><span style="display: inline-block; position: relative; width: 1.432em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.78em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-104" style="font-family: MathJax_Math-italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.182em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -4.402em; left: 0.896em;"><span class="mi" id="MathJax-Span-105" style="font-size: 70.7%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-106"><span style="display: inline-block; position: relative; width: 1.313em; height: 0px;"><span style="position: absolute; clip: rect(3.098em 1000.78em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-107" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.717em;"><span class="mi" id="MathJax-Span-108" style="font-size: 70.7%; font-family: MathJax_Math-italic;">U<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-109"><span style="display: inline-block; position: relative; width: 1.134em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.78em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-110" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.122em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.658em;"><span class="mi" id="MathJax-Span-111" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="mo" id="MathJax-Span-112" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.504em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation">
</blockquote>


项因子以一种相似的方式计算，而整个值是通过来回交替进行最小化，直到其收敛（因此，‘交叉最小二乘法’由此得名）。

这个论文的巧妙之处在于，它如何对所有数据进行学习，但只需要对那些非零项进行处理。由于<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>P</mi><mi>u</mi></msub></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-113" role="math" style="width: 1.432em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.372em 1001.19em 2.562em -999.997em); top: -2.199em; left: 0.003em;"><span class="mrow" id="MathJax-Span-114"><span class="msubsup" id="MathJax-Span-115"><span style="display: inline-block; position: relative; width: 1.134em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.78em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-116" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.122em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.658em;"><span class="mi" id="MathJax-Span-117" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.146em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"> 是稀疏的(负值偏好有一个0值)， <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>Y</mi><mi>T</mi></msup><msub><mi>C</mi><mi>u</mi></msub><msub><mi>P</mi><mi>u</mi></msub></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-118" role="math" style="width: 4.586em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.812em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.193em 1003.81em 2.562em -999.997em); top: -2.199em; left: 0.003em;"><span class="mrow" id="MathJax-Span-119"><span class="msubsup" id="MathJax-Span-120"><span style="display: inline-block; position: relative; width: 1.432em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.78em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-121" style="font-family: MathJax_Math-italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.182em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -4.342em; left: 0.896em;"><span class="mi" id="MathJax-Span-122" style="font-size: 70.7%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-123"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.098em 1000.78em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-124" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.717em;"><span class="mi" id="MathJax-Span-125" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-126"><span style="display: inline-block; position: relative; width: 1.134em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.78em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-127" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.122em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.658em;"><span class="mi" id="MathJax-Span-128" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.361em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"> 可以容易进行技术。要计算 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>Y</mi><mi>T</mi></msup><msub><mi>C</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>u</mi></mrow></msub><mi>Y</mi></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-129" role="math" style="width: 4.11em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.396em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.193em 1003.4em 2.562em -999.997em); top: -2.199em; left: 0.003em;"><span class="mrow" id="MathJax-Span-130"><span class="msubsup" id="MathJax-Span-131"><span style="display: inline-block; position: relative; width: 1.432em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.78em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-132" style="font-family: MathJax_Math-italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.182em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -4.342em; left: 0.896em;"><span class="mi" id="MathJax-Span-133" style="font-size: 70.7%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-134"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.098em 1000.78em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-135" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.717em;"><span class="texatom" id="MathJax-Span-136"><span class="mrow" id="MathJax-Span-137"><span class="mi" id="MathJax-Span-138" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="mi" id="MathJax-Span-139" style="font-family: MathJax_Math-italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.182em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.361em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation">，他们指出，它等价于<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>Y</mi><mi>T</mi></msup><mi>Y</mi><mo>+</mo><msup><mi>Y</mi><mi>T</mi></msup><mo stretchy=&quot;false&quot;>(</mo><msub><mi>C</mi><mi>u</mi></msub><mo>&amp;#x2212;</mo><mi>I</mi><mo stretchy=&quot;false&quot;>)</mo><mi>Y</mi></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-140" role="math" style="width: 11.313em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.408em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.193em 1009.41em 2.622em -999.997em); top: -2.199em; left: 0.003em;"><span class="mrow" id="MathJax-Span-141"><span class="msubsup" id="MathJax-Span-142"><span style="display: inline-block; position: relative; width: 1.432em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.78em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-143" style="font-family: MathJax_Math-italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.182em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -4.342em; left: 0.896em;"><span class="mi" id="MathJax-Span-144" style="font-size: 70.7%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="mi" id="MathJax-Span-145" style="font-family: MathJax_Math-italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.182em;"></span></span><span class="mo" id="MathJax-Span-146" style="font-family: MathJax_Main; padding-left: 0.241em;">+</span><span class="msubsup" id="MathJax-Span-147" style="padding-left: 0.241em;"><span style="display: inline-block; position: relative; width: 1.432em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.78em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-148" style="font-family: MathJax_Math-italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.182em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -4.342em; left: 0.896em;"><span class="mi" id="MathJax-Span-149" style="font-size: 70.7%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="mo" id="MathJax-Span-150" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-151"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.098em 1000.78em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-152" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.717em;"><span class="mi" id="MathJax-Span-153" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="mo" id="MathJax-Span-154" style="font-family: MathJax_Main; padding-left: 0.241em;">−</span><span class="mi" id="MathJax-Span-155" style="font-family: MathJax_Math-italic; padding-left: 0.241em;">I<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span class="mo" id="MathJax-Span-156" style="font-family: MathJax_Main;">)</span><span class="mi" id="MathJax-Span-157" style="font-family: MathJax_Math-italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.182em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.432em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation">。通过设置负值项的置信度为1，<nobr aria-hidden="true"><span class="math" id="MathJax-Span-158" role="math" style="width: 4.527em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.753em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.253em 1003.63em 2.622em -999.997em); top: -2.199em; left: 0.003em;"><span class="mrow" id="MathJax-Span-159"><span class="mo" id="MathJax-Span-160" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-161"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.098em 1000.78em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-162" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -3.807em; left: 0.717em;"><span class="mi" id="MathJax-Span-163" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="mo" id="MathJax-Span-164" style="font-family: MathJax_Main; padding-left: 0.241em;">−</span><span class="mi" id="MathJax-Span-165" style="font-family: MathJax_Math-italic; padding-left: 0.241em;">I<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span class="mo" id="MathJax-Span-166" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.361em;"></span></span></nobr>是稀疏的，并且<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>Y</mi><mi>T</mi></msup><mi>Y</mi></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-167" role="math" style="width: 2.682em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.205em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.193em 1002.21em 2.384em -999.997em); top: -2.199em; left: 0.003em;"><span class="mrow" id="MathJax-Span-168"><span class="msubsup" id="MathJax-Span-169"><span style="display: inline-block; position: relative; width: 1.432em; height: 0px;"><span style="position: absolute; clip: rect(3.158em 1000.78em 4.17em -999.997em); top: -3.985em; left: 0.003em;"><span class="mi" id="MathJax-Span-170" style="font-family: MathJax_Math-italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.182em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span><span style="position: absolute; top: -4.342em; left: 0.896em;"><span class="mi" id="MathJax-Span-171" style="font-size: 70.7%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span class="mi" id="MathJax-Span-172" style="font-family: MathJax_Math-italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.182em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.146em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"> 可以对所有用户进行预运算。


将这整个算法放到Python中，你会得到像这样的代码：

```python
def alternating_least_squares(Cui, factors, regularization, iterations=20):
    users, items = Cui.shape

    X = np.random.rand(users, factors) * 0.01
    Y = np.random.rand(items, factors) * 0.01

    Ciu = Cui.T.tocsr()
    for iteration in range(iterations):
        least_squares(Cui, X, Y, regularization)
        least_squares(Ciu, Y, X, regularization)

    return X, Y

def least_squares(Cui, X, Y, regularization):
    users, factors = X.shape
    YtY = Y.T.dot(Y)

    for u in range(users):
        # accumulate YtCuY + regularization * I in A
        A = YtY + regularization * np.eye(factors)

        # accumulate YtCuPu in b
        b = np.zeros(factors)

        for i, confidence in nonzeros(Cui, u):
            factor = Y[i]
            A += (confidence - 1) * np.outer(factor, factor)
            b += confidence * factor

        # Xu = (YtCuY + regularization * I)^-1 (YtCuPu)
        X[u] = np.linalg.solve(A, b)

```

要调用它，对于置信矩阵，我是用了与我们在LSA中使用的相同的权重，然后以相同的方式计算相关艺术家：

```python
artist_factors, user_factors = alternating_least_squares(bm25_weight(plays), 50)
```

This method leads to significantly better results than just using LSA. Take a look at a
与只使用LSA相比，这个方法可以获得一个明显更好的结果。以 Bob Dylan为例，看看一个[slopegraph](http://charliepark.org/slopegraphs/)：

<div class="slopegraph well" style="background:#FFFFFF;">
    <div class="input-group">
        <div class="input-group-btn left" style="text-align:right">
            <button type="button" class="btn btn-default dropdown-toggle lleft" data-toggle="dropdown" style="width: 200px;">
              <span class="method"><font><font>LSA</font></font></span> <span class="caret"></span>
            </button>
            <ul class="dropdown-menu metrics" role="menu" style="width: 200px;">
            <li class="lsi"><a><font><font>LSA</font></font></a></li><li class="implicitals"><a><font><font>隐ALS</font></font></a></li><li class="divider"></li><li class="overlap"><a><font><font>交叠</font></font></a></li><li class="jaccard"><a><font><font>杰卡德</font></font></a></li><li class="ochiai"><a><font><font>落合</font></font></a></li><li class="cosine"><a><font><font>余弦</font></font></a></li><li class="smoothed_cosine"><a><font><font>平滑余弦</font></font></a></li><li class="tfidf"><a><font><font>TFIDF</font></font></a></li><li class="bm25"><a><font><font>BM25</font></font></a></li></ul>
        </div>
        <span class="twitter-typeahead" style="position: relative"><input class="form-control typeahead middle tt-hint" readonly="" autocomplete="off" spellcheck="false" tabindex="-1" style="position: absolute; top: 0px; left: 0px; border-color: transparent; box-shadow: none; opacity: 1; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(255, 255, 255);"><input class="form-control typeahead middle tt-input" id="set-artist-name" placeholder="Enter an Artist Name" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top; background-color: transparent;"><pre aria-hidden="true" style="position: absolute; visibility: hidden; white-space: pre; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: 400; word-spacing: 0px; letter-spacing: 0px; text-indent: 0px; text-rendering: auto; text-transform: none;"></pre><span class="tt-dropdown-menu" style="position: absolute; top: 100%; z-index: 100; display: none; left: 0px; right: auto;"><div class="tt-dataset-artists"></div></span></span>
        <div class="input-group-btn right">
            <button type="button" class="btn btn-default dropdown-toggle rright" data-toggle="dropdown" style="width: 200px;">
              <span class="caret"></span>
              <span class="method"><font><font>隐ALS</font></font></span>
            </button>
            <ul class="dropdown-menu metrics" role="menu" style="width: 200px;">
            <li class="lsi"><a><font><font>LSA</font></font></a></li><li class="implicitals"><a><font><font>隐ALS</font></font></a></li><li class="divider"></li><li class="overlap"><a><font><font>交叠</font></font></a></li><li class="jaccard"><a><font><font>杰卡德</font></font></a></li><li class="ochiai"><a><font><font>落合</font></font></a></li><li class="cosine"><a><font><font>余弦</font></font></a></li><li class="smoothed_cosine"><a><font><font>平滑余弦</font></font></a></li><li class="tfidf"><a><font><font>TFIDF</font></font></a></li><li class="bm25"><a><font><font>BM25</font></font></a></li></ul>
        </div>
    </div>
    <hr>
    <h4 style="text-align:center">
        <span class="title"><font><font>鲍勃·迪伦</font></font></span>
        <br>
        <small class="subtitle"><font><font>LSA与隐ALS</font></font></small>
    </h4>
    <div class="graph"><svg height="897.975376119831" width="710"><g><text class="lefttext" x="200" y="15" dy=".35em" text-anchor="end" style="font-size: 12px; fill: rgb(31, 119, 180);">Neil Young - #1</text><text class="righttext" x="510" y="15" dy=".35em" style="font-size: 12px; fill: rgb(255, 127, 14);">#1 - Neil Young</text><line x1="207.5" x2="502.5" y1="15" y2="15" stroke="black" stroke-width="1" stroke-opacity="0.4"></line></g><g><text class="lefttext" x="200" y="103.722839111673" dy=".35em" text-anchor="end" style="font-size: 12px; fill: rgb(31, 119, 180);">Loudon Wainwright Iii - #2</text><text class="righttext" x="510" y="499.3762731415374" dy=".35em" style="font-size: 12px; fill: rgb(255, 127, 14);">#44 - Loudon Wainwright Iii</text><line x1="207.5" x2="502.5" y1="103.722839111673" y2="499.3762731415374" stroke="black" stroke-width="1" stroke-opacity="0.4"></line></g><g><text class="lefttext" x="200" y="155.62237294951805" dy=".35em" text-anchor="end" style="font-size: 12px; fill: rgb(31, 119, 180);">Elvis Costello &amp; The Imposters - #3</text><text class="righttext" x="510" y="882.975376119831" dy=".35em" style="font-size: 12px; fill: rgb(255, 127, 14);">#881 - Elvis Costello &amp; The Imposters</text><line x1="207.5" x2="502.5" y1="155.62237294951805" y2="882.975376119831" stroke="black" stroke-width="1" stroke-opacity="0.4"></line></g><g><text class="lefttext" x="200" y="192.445678223346" dy=".35em" text-anchor="end" style="font-size: 12px; fill: rgb(31, 119, 180);">Tim Keller - #4</text><text class="righttext" x="510" y="711.074151542169" dy=".35em" style="font-size: 12px; fill: rgb(255, 127, 14);">#230 - Tim Keller</text><line x1="207.5" x2="502.5" y1="192.445678223346" y2="711.074151542169" stroke="black" stroke-width="1" stroke-opacity="0.4"></line></g><g><text class="lefttext" x="200" y="221.00805279156484" dy=".35em" text-anchor="end" style="font-size: 12px; fill: rgb(31, 119, 180);">The Umbrellas Of Cherbourg - #5</text><text class="righttext" x="510" y="711.6294669467895" dy=".35em" style="font-size: 12px; fill: rgb(255, 127, 14);">#231 - The Umbrellas Of Cherbourg</text><line x1="207.5" x2="502.5" y1="221.00805279156484" y2="711.6294669467895" stroke="black" stroke-width="1" stroke-opacity="0.4"></line></g><g><text class="lefttext" x="200" y="244.34521206119103" dy=".35em" text-anchor="end" style="font-size: 12px; fill: rgb(31, 119, 180);">Muy Cansado - #6</text><text class="righttext" x="510" y="641.9234943937166" dy=".35em" style="font-size: 12px; fill: rgb(255, 127, 14);">#134 - Muy Cansado</text><line x1="207.5" x2="502.5" y1="244.34521206119103" y2="641.9234943937166" stroke="black" stroke-width="1" stroke-opacity="0.4"></line></g><g><text class="lefttext" x="200" y="264.0764990790801" dy=".35em" text-anchor="end" style="font-size: 12px; fill: rgb(31, 119, 180);">Elvis Costello - #7</text><text class="righttext" x="510" y="427.0161055831297" dy=".35em" style="font-size: 12px; fill: rgb(255, 127, 14);">#25 - Elvis Costello</text><line x1="207.5" x2="502.5" y1="264.0764990790801" y2="427.0161055831297" stroke="black" stroke-width="1" stroke-opacity="0.4"></line></g><g><text class="lefttext" x="200" y="391.88818933330435" dy=".35em" text-anchor="end" style="font-size: 12px; fill: rgb(31, 119, 180);">Bob Dylan And The Band - #19</text><text class="righttext" x="510" y="103.722839111673" dy=".35em" style="font-size: 12px; fill: rgb(255, 127, 14);">#2 - Bob Dylan And The Band</text><line x1="207.5" x2="502.5" y1="391.88818933330435" y2="103.722839111673" stroke="black" stroke-width="1" stroke-opacity="0.4"></line></g><g><text class="lefttext" x="200" y="515.7389446948027" dy=".35em" text-anchor="end" style="font-size: 12px; fill: rgb(31, 119, 180);">Donovan - #50</text><text class="righttext" x="510" y="192.445678223346" dy=".35em" style="font-size: 12px; fill: rgb(255, 127, 14);">#4 - Donovan</text><line x1="207.5" x2="502.5" y1="515.7389446948027" y2="192.445678223346" stroke="black" stroke-width="1" stroke-opacity="0.4"></line></g><g><text class="lefttext" x="200" y="590.9756378022739" dy=".35em" text-anchor="end" style="font-size: 12px; fill: rgb(31, 119, 180);">The Band - #90</text><text class="righttext" x="510" y="155.62237294951805" dy=".35em" style="font-size: 12px; fill: rgb(255, 127, 14);">#3 - The Band</text><line x1="207.5" x2="502.5" y1="590.9756378022739" y2="155.62237294951805" stroke="black" stroke-width="1" stroke-opacity="0.4"></line></g><g><text class="lefttext" x="200" y="621.2334013944954" dy=".35em" text-anchor="end" style="font-size: 12px; fill: rgb(31, 119, 180);">Van Morrison - #114</text><text class="righttext" x="510" y="244.34521206119103" dy=".35em" style="font-size: 12px; fill: rgb(255, 127, 14);">#6 - Van Morrison</text><line x1="207.5" x2="502.5" y1="621.2334013944954" y2="244.34521206119103" stroke="black" stroke-width="1" stroke-opacity="0.4"></line></g><g><text class="lefttext" x="200" y="657.2118191123103" dy=".35em" text-anchor="end" style="font-size: 12px; fill: rgb(31, 119, 180);">The Kinks - #151</text><text class="righttext" x="510" y="221.00805279156484" dy=".35em" style="font-size: 12px; fill: rgb(255, 127, 14);">#5 - The Kinks</text><line x1="207.5" x2="502.5" y1="657.2118191123103" y2="221.00805279156484" stroke="black" stroke-width="1" stroke-opacity="0.4"></line></g><g><text class="lefttext" x="200" y="704.8011814165121" dy=".35em" text-anchor="end" style="font-size: 12px; fill: rgb(31, 119, 180);">Buffalo Springfield - #219</text><text class="righttext" x="510" y="264.0764990790801" dy=".35em" style="font-size: 12px; fill: rgb(255, 127, 14);">#7 - Buffalo Springfield</text><line x1="207.5" x2="502.5" y1="704.8011814165121" y2="264.0764990790801" stroke="black" stroke-width="1" stroke-opacity="0.4"></line></g></svg></div>
</div>

这里，LSA返回的不相干结果被挤出了列表的头部，并且被相干结果所取代。

隐性ALS的好处是，它仍然成功地一般化了输入。举个例子，无论是Guns N' Roses还是Nick Cave And The Bad Seeds，都仍然得到了它们的同类，只是没有由LSA返回的一些边际结果。

### 性能

在计算像这样的相关艺术家的过程中，有一些性能挑战。

我在上面贴出来的隐式ALS代码并不是非常快。由于每个用户因子可以彼此独立被计算，因此该算法是令人尴尬地并行的，并且非常适合多线程 —— 这是纯Python代码不擅长的。

为了克服这个问题，我[发布了一个快的Python版本](https://github.com/benfred/implicit)，该版本使用Cython和OpenMP来并行化计算。在这个任务中，比Quora刚在他们的[QMF库](https://github.com/quora/qmf)上发布的多线程C++版本，[当前会快1.8倍](https://github.com/benfred/implicit/blob/master/examples/benchmark.py)。

通过并行计算，该库可以在一个[c4.8xlarge](http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/c4-instances.html#c4-instances-cpu-support) EC2实例上，大约40s内分解Last.fm数据集 (50个因子，15次迭代)。

问题是，一旦分解结束，使用这些因子来计算所有最相关的艺术家要花费大约一个小时。要做到准确的近邻计算则需要O(N<sup>2</sup>)，因为我们需要将艺术家两两对比。

使用近似近邻搜索是有可能更快的。[annoy](http://github.com/spotify/annoy)包使用一个随机的超平面分割方法来建立搜索树森林，从而有效地计算最近的邻居。

annoy包带有Python绑定。要使用余弦距离来生成近似最近邻居，使用这些绑定是非常简单的：

```python
class ApproximateTopRelated(object):
    def __init__(self, artist_factors, treecount=20):
        index = annoy.AnnoyIndex(artist_factors.shape[1], 'angular')
        for i, row in enumerate(artist_factors):
            index.add_item(i, row)
        index.build(treecount)
        self.index = index

    def get_related(self, artistid, N=10):
        neighbours = self.index.get_nns_by_item(artistid, N)
        return sorted(((other, 1 - self.index.get_distance(artistid, other))
                      for other in neighbours), key=lambda x: -x[1])
```

使用这种方法的结果大致相同，并将计算所有艺术家的时间从一小时减少到大约30s，这还包含了在首位建立索引的时间。

如果你有兴趣了解更多，Erik Bernhardsson有一[系列](http://erikbern.com/2015/09/24/nearest-neighbor-methods-vector-models-part-1/)关于[annoy如何工作](http://erikbern.com/2015/10/01/nearest-neighbors-and-vector-models-part-2-how-to-search-in-high-dimensional-spaces/)的[不错的博文](http://erikbern.com/2015/10/20/nearest-neighbors-and-vector-models-epilogue-curse-of-dimensionality/)。

### 总结

矩阵分解方法，例如隐式ALS通常用于生成个性化结果，但也有一些上升空间来将这些模型用于生成相关艺术家列表的更简单的任务。

事实上，Spotify使用了一个名为[逻辑矩阵分解(Logistic Matrix Factorization)](http://stanford.edu/~rezab/nips2014workshop/submits/logmat.pdf)的矩阵分解技术来生成相关艺术家列表。这个方法与隐式ALS想法类似：它是在二分偏好数据上的一个置信加权因子，但它使用了一个逻辑损失，而不是最小平方损失。该论文用一些例子说明了在哪些地方，逻辑矩阵分解在计算相似艺术家时会比隐式ALS好[(2)](#footnote2)。

还有许多其他矩阵分解方法可以用来代替在这里讲到的方法。例如，[贝叶斯个性化排名(Bayesian Personalized Ranking)](http://www.algo.uni-konstanz.de/members/rendle/pdf/Rendle_et_al2009-Bayesian_Personalized_Ranking.pdf)，和[协同少即是多过滤(Collaborative Less-is-More Filtering)](http://www.ci.tuwien.ac.at/~alexis/Publications_files/climf-recsys12.pdf) 都试图学习用来为每个用户优化艺术家排名的因式分解表示。

这些模型的真正力量在于，为每个用户生成个性化推荐，对此，我希望在以后的博文中可以深入探讨。

##### Footnote 1

像LSA这样的技术，在进行矩阵分解之前，通常使用TFIDF来加权输入矩阵。然而，根据之前的博文，我们知道，BM25加权在计算艺术家之间的相似性时会得到一些好的结果。因此，在这里，我使用它来代替。见[我的隐式库中的样例应用](https://github.com/benfred/implicit/blob/master/examples/lastfm.py)中的代码，看看如何有效地做这件事。


##### Footnote 2

这里，隐式ALS的结果比那些在Logistic Matrix
Factorization paper上报道的好得多 (除了Mumford Sons，在Last.fm数据集发布之后，他变得流行起来)。这主要是因为我如何加权信心矩阵 —— 通过使用一个简单的线性加权，我也获得了棒棒的结果。


<link href="http://static.benfrederickson.com.s3-website-us-east-1.amazonaws.com/bootstrap-3.0.0/css/bootstrap.min.css" rel="stylesheet">
<style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Main; src: url('http://cdn.mathjax.org/mathjax/2.6-latest/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff?rev=2.6.1') format('woff'), url('http://cdn.mathjax.org/mathjax/2.6-latest/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf?rev=2.6.1') format('opentype')}
@font-face {font-family: MathJax_Main-bold; src: url('http://cdn.mathjax.org/mathjax/2.6-latest/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff?rev=2.6.1') format('woff'), url('http://cdn.mathjax.org/mathjax/2.6-latest/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf?rev=2.6.1') format('opentype')}
@font-face {font-family: MathJax_Main-italic; src: url('http://cdn.mathjax.org/mathjax/2.6-latest/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff?rev=2.6.1') format('woff'), url('http://cdn.mathjax.org/mathjax/2.6-latest/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf?rev=2.6.1') format('opentype')}
@font-face {font-family: MathJax_Math-italic; src: url('http://cdn.mathjax.org/mathjax/2.6-latest/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff?rev=2.6.1') format('woff'), url('http://cdn.mathjax.org/mathjax/2.6-latest/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf?rev=2.6.1') format('opentype')}
@font-face {font-family: MathJax_Caligraphic; src: url('http://cdn.mathjax.org/mathjax/2.6-latest/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff?rev=2.6.1') format('woff'), url('http://cdn.mathjax.org/mathjax/2.6-latest/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf?rev=2.6.1') format('opentype')}
@font-face {font-family: MathJax_Size1; src: url('http://cdn.mathjax.org/mathjax/2.6-latest/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff?rev=2.6.1') format('woff'), url('http://cdn.mathjax.org/mathjax/2.6-latest/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf?rev=2.6.1') format('opentype')}
@font-face {font-family: MathJax_Size2; src: url('http://cdn.mathjax.org/mathjax/2.6-latest/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff?rev=2.6.1') format('woff'), url('http://cdn.mathjax.org/mathjax/2.6-latest/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf?rev=2.6.1') format('opentype')}
@font-face {font-family: MathJax_Size3; src: url('http://cdn.mathjax.org/mathjax/2.6-latest/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff?rev=2.6.1') format('woff'), url('http://cdn.mathjax.org/mathjax/2.6-latest/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf?rev=2.6.1') format('opentype')}
@font-face {font-family: MathJax_Size4; src: url('http://cdn.mathjax.org/mathjax/2.6-latest/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff?rev=2.6.1') format('woff'), url('http://cdn.mathjax.org/mathjax/2.6-latest/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf?rev=2.6.1') format('opentype')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style>
